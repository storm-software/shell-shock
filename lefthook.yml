#
#   Refer for explanation to following link:
#   https://github.com/evilmartians/lefthook/blob/master/docs/configuration.md
#

assert_lefthook_installed: true
colors: true
no_tty: false
min_version: 1.5.0

pre-commit:
  piped: true
  commands:
    install:
      glob: "./{pnpm-lock.yaml,lefthook.yml}"
      run: "pnpm install && pnpm lefthook install"
      stage_fixed: true
    nx-sync:
      glob: "**/*"
      run: "pnpm nx sync"
      stage_fixed: true
    prepare:
      glob: "**/{lefthook.yml,biome.json}"
      run: pnpm exec storm-prepare
    validate:
      glob: "**/*"
      run: "pnpm exec storm-pre-commit {staged_files}"
      stage_fixed: true
    lint:
      glob:
        - "*.js"
        - "*.ts"
        - "*.cjs"
        - "*.mjs"
        - "*.d.cts"
        - "*.d.mts"
        - "*.jsx"
        - "*.tsx"
        - "*.json"
        - "*.jsonc"
        - "*.yaml"
        - "*.yml"
        - "*.md"
        - "*.mdx"
        - "*.markdown"
        - "*.css"
        - "*.scss"
        - "*.sass"
        - "*.less"
        - "*.stylus"
        - "*.graphql"
        - "*.gql"
        - "*.xml"
        - "*.svg"
        - "*.env"
        - ".env.{local,development,test,production,staging}"
      run: pnpm exec storm-lint all --skip-cspell --skip-circular-deps
      stage_fixed: true

commit-msg:
  commands:
    validate:
      run: "pnpm exec storm-git commitlint --message {1}"

pre-push:
  piped: true
  commands:
    nx-sync:
      glob: "**/*"
      run: "pnpm nx sync"
      stage_fixed: true
    build:
      glob: "**/*"
      run: pnpm build
      stage_fixed: true
    validate:
      glob: "**/*"
      run: "pnpm exec storm-pre-push {staged_files}"
      stage_fixed: true
    lint-codeowners:
      glob: "**/CODEOWNERS"
      run: pnpm exec storm-lint codeowners
    readme:
      glob: "**/*"
      run:
        'pnpm exec storm-git readme --templates="tools/readme-templates"
        --project="@monorepo-template/monorepo" '
      stage_fixed: true
    format:
      glob: "**/*"
      run: "pnpm format {staged_files}"
      stage_fixed: true

post-merge:
  commands:
    validate:
      glob: "**/*.*"
      run: "pnpm exec storm-post-merge {staged_files}"
      stage_fixed: true

post-checkout:
  commands:
    validate:
      glob: "**/*.*"
      run: "pnpm exec storm-post-checkout {staged_files}"

post-commit:
  commands:
    validate:
      glob: "**/*.*"
      run: "pnpm exec storm-post-commit {staged_files}"
